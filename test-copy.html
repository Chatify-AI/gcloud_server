<!DOCTYPE html>
<html>
<head>
    <title>复制功能测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-box { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .test-text { background: #f5f5f5; padding: 10px; font-family: monospace; word-break: break-all; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>复制功能测试页面</h1>

    <div class="test-box">
        <h3>测试1: 现代 Clipboard API</h3>
        <div class="test-text" id="text1">这是要复制的文本内容 - 测试现代API</div>
        <button onclick="testModernClipboard()">复制 (现代 API)</button>
        <div id="result1"></div>
    </div>

    <div class="test-box">
        <h3>测试2: 降级方案 (execCommand)</h3>
        <div class="test-text" id="text2">这是要复制的文本内容 - 测试降级方案</div>
        <button onclick="testFallbackCopy()">复制 (降级方案)</button>
        <div id="result2"></div>
    </div>

    <div class="test-box">
        <h3>测试3: 长文本复制</h3>
        <div class="test-text" id="text3">gck_1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7a8b9c0d1e2f3g4h5i6j7k8l9m0n1o2p3q4r5s6t7u8v9w0x1y2z3a4b5c6d7e8f9g0h1i2j3k4l5m6n7o8p9q0r1s2t3u4v5w6x7y8z9a0b1c2d3e4f5g6h7i8j9k0l1m2n3o4p5q6r7s8t9u0v1w2x3y4z5a6b7c8d9e0f1g2h3i4j5k6l7m8n9o0p1q2r3s4t5u6v7w8x9y0z1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z</div>
        <button onclick="testLongText()">复制长文本</button>
        <div id="result3"></div>
    </div>

    <div class="test-box">
        <h3>测试4: 手动复制对话框</h3>
        <div class="test-text" id="text4">测试手动复制功能的文本内容</div>
        <button onclick="testManualCopy()">显示手动复制对话框</button>
        <div id="result4"></div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<span class="${type}">${message}</span>`;

            // 3秒后清除消息
            setTimeout(() => {
                element.innerHTML = '';
            }, 3000);
        }

        async function testModernClipboard() {
            const text = document.getElementById('text1').textContent;

            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                    showResult('result1', '✓ 现代 Clipboard API 复制成功！', 'success');
                } else {
                    showResult('result1', '✗ 不支持现代 Clipboard API (需要 HTTPS)', 'error');
                }
            } catch (err) {
                showResult('result1', `✗ 现代 API 失败: ${err.message}`, 'error');
            }
        }

        function testFallbackCopy() {
            const text = document.getElementById('text2').textContent;

            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.top = '0';
                textarea.style.left = '0';
                textarea.style.opacity = '0';
                textarea.style.pointerEvents = 'none';
                textarea.setAttribute('readonly', '');

                document.body.appendChild(textarea);
                textarea.select();
                textarea.setSelectionRange(0, 99999);

                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);

                if (successful) {
                    showResult('result2', '✓ 降级方案复制成功！', 'success');
                } else {
                    showResult('result2', '✗ execCommand 返回 false', 'error');
                }
            } catch (err) {
                showResult('result2', `✗ 降级方案失败: ${err.message}`, 'error');
            }
        }

        function testLongText() {
            const text = document.getElementById('text3').textContent;

            // 尝试现代 API 优先
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => showResult('result3', '✓ 长文本复制成功（现代 API）！', 'success'))
                    .catch(() => fallbackLongCopy(text));
            } else {
                fallbackLongCopy(text);
            }
        }

        function fallbackLongCopy(text) {
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.top = '0';
                textarea.style.left = '0';
                textarea.style.opacity = '0';

                document.body.appendChild(textarea);
                textarea.select();

                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);

                if (successful) {
                    showResult('result3', '✓ 长文本复制成功（降级方案）！', 'success');
                } else {
                    showResult('result3', '✗ 长文本复制失败', 'error');
                }
            } catch (err) {
                showResult('result3', `✗ 长文本复制失败: ${err.message}`, 'error');
            }
        }

        function testManualCopy() {
            const text = document.getElementById('text4').textContent;

            const copyDialog = document.createElement('div');
            copyDialog.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 80%;
                word-break: break-all;
                border: 2px solid #1976d2;
            `;

            copyDialog.innerHTML = `
                <div style="margin-bottom: 10px; font-weight: bold; color: #1976d2;">请手动复制以下内容:</div>
                <textarea readonly style="width: 100%; height: 100px; margin-bottom: 10px; font-size: 12px; font-family: monospace; border: 1px solid #ccc; padding: 5px;">${text}</textarea>
                <div style="text-align: right;">
                    <button onclick="this.parentElement.parentElement.remove()" style="padding: 8px 16px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;">关闭</button>
                </div>
            `;

            document.body.appendChild(copyDialog);

            // 自动选择文本
            const textarea = copyDialog.querySelector('textarea');
            textarea.focus();
            textarea.select();

            showResult('result4', '✓ 手动复制对话框已显示', 'success');

            // 10秒后自动关闭
            setTimeout(() => {
                if (copyDialog.parentNode) {
                    copyDialog.remove();
                }
            }, 10000);
        }

        // 页面加载时显示环境信息
        window.onload = function() {
            const info = document.createElement('div');
            info.style.cssText = 'background: #f0f0f0; padding: 10px; margin-bottom: 20px; border-radius: 5px;';
            info.innerHTML = `
                <strong>环境信息:</strong><br>
                • Protocol: ${window.location.protocol}<br>
                • isSecureContext: ${window.isSecureContext}<br>
                • navigator.clipboard: ${navigator.clipboard ? '✓ 支持' : '✗ 不支持'}<br>
                • User Agent: ${navigator.userAgent}
            `;
            document.body.insertBefore(info, document.body.firstChild);
        };
    </script>
</body>
</html>