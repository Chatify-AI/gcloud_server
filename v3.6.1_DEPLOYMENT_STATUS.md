# GCloud Server v3.6.1 - éƒ¨ç½²ç°çŠ¶æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“ä¿®å¤
- **æ–‡ä»¶**: `docker-prod/mysql/init-scripts/01-init.sql`
- **ä¿®å¤å†…å®¹**:
  - æ·»åŠ ç¼ºå¤±çš„å­—æ®µï¼š`project_name`, `need_monitor`, `script_execution_count`, `last_monitor_time`
  - æ·»åŠ CASCADEå¤–é”®çº¦æŸï¼ˆcommand_executions, gcloud_monitor_logsï¼‰
  - å®Œæ•´çš„11ä¸ªè¡¨ç»“æ„å®šä¹‰
- **éªŒè¯**: MySQLåˆå§‹åŒ–è„šæœ¬æˆåŠŸä¸‹è½½å¹¶æ‰§è¡Œ âœ…

### 2. å•æ–‡ä»¶éƒ¨ç½²æ–¹æ¡ˆ
#### docker-compose.quick.yml
- **ç‰¹ç‚¹**: æœ€ç®€åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆ
- **è‡ªåŠ¨åŒ–**: config-initå®¹å™¨è‡ªåŠ¨ä»GitHubä¸‹è½½SQLæ–‡ä»¶
- **ç«¯å£**: ç›´æ¥è®¿é—®5080ï¼ˆmainæœåŠ¡ï¼‰
- **SQLåˆå§‹åŒ–**: æˆåŠŸ âœ…
- **é—®é¢˜**: mainæœåŠ¡å¯åŠ¨åå´©æºƒ âŒ

#### docker-compose.standalone.yml
- **ç‰¹ç‚¹**: åŒ…å«Nginxåå‘ä»£ç†
- **è‡ªåŠ¨åŒ–**: åŒæ ·è‡ªåŠ¨ä¸‹è½½é…ç½®æ–‡ä»¶
- **ç«¯å£**: é€šè¿‡Nginx 5080è®¿é—®
- **SQLåˆå§‹åŒ–**: æˆåŠŸ âœ…
- **é—®é¢˜**: mainæœåŠ¡å¯åŠ¨åå´©æºƒ âŒ

### 3. Dockeré•œåƒ
- **ä½ç½®**: Docker Hub (luzhipeng728/gcloud-*-service)
- **ç‰ˆæœ¬**: v3.6.0 å’Œ latest
- **é•œåƒåˆ—è¡¨**:
  - gcloud-main-service:v3.6.0 (1.7GB)
  - gcloud-executor-service:v3.6.0 (2.36GB)
  - gcloud-stats-service:v3.6.0 (303MB)
  - gcloud-ftp-service:v3.6.0 (148MB)

### 4. æ–‡æ¡£
- `QUICK_DEPLOY.md`: è¯¦ç»†çš„å¿«é€Ÿéƒ¨ç½²æŒ‡å—
- `deploy/README.md`: å®Œæ•´éƒ¨ç½²åŒ…è¯´æ˜
- `.env.example`: å®Œæ•´çš„ç¯å¢ƒå˜é‡æ¨¡æ¿

## âš ï¸ å½“å‰é—®é¢˜

### MainæœåŠ¡å´©æºƒ
**ç—‡çŠ¶**:
```
=========================================
GCloud Manager - Main Service
=========================================
â³ ç­‰å¾… MySQL æ•°æ®åº“...
âœ… MySQL å·²å°±ç»ª
â³ ç­‰å¾… Redis...
âœ… Redis å·²å°±ç»ª
ğŸ”§ åˆå§‹åŒ– GCloud é…ç½®...
ğŸš€ å¯åŠ¨åº”ç”¨...
[å®¹å™¨é€€å‡ºï¼Œé€€å‡ºç : 1]
```

**ç‰¹å¾**:
- MySQLå’ŒRedisè¿æ¥æ£€æŸ¥é€šè¿‡
- å¯åŠ¨åçº¦1ç§’å³å´©æºƒ
- æ²¡æœ‰æ˜æ˜¾çš„é”™è¯¯è¾“å‡ºåˆ°stdout/stderr
- å®¹å™¨ä¸æ–­é‡å¯ï¼ˆrestart policyï¼‰

**å¯èƒ½åŸå› **:
1. æ•°æ®åº“è¿æ¥/è®¤è¯é—®é¢˜
2. Sequelizeæ¨¡å‹åŒæ­¥å¤±è´¥
3. ç¼ºå¤±çš„ç¯å¢ƒå˜é‡
4. Node.jsåº”ç”¨å†…éƒ¨é”™è¯¯æœªæ•è·

## ğŸ” è°ƒè¯•ä¿¡æ¯

### MySQLçŠ¶æ€
```bash
# åˆå§‹åŒ–æ—¥å¿—æ˜¾ç¤ºæˆåŠŸ
[Note] [Entrypoint]: /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/01-init.sql
[Note] [Entrypoint]: MySQL init process done. Ready for start up.
```

### ç”¨æˆ·æƒé™é—®é¢˜
- gcloudç”¨æˆ·æ— æ³•ä»å¤–éƒ¨è¿æ¥ï¼ˆ172.27.0.1ï¼‰
- rootç”¨æˆ·ä¹Ÿæ— æ³•ä»å¤–éƒ¨è¿æ¥
- å¯èƒ½ä¸MySQLé»˜è®¤å®‰å…¨é…ç½®æœ‰å…³

### å®¹å™¨çŠ¶æ€
```json
{
  "Status": "restarting",
  "ExitCode": 1,
  "Health": {
    "Status": "unhealthy"
  }
}
```

## ğŸ“‹ å»ºè®®çš„ä¸‹ä¸€æ­¥

### 1. è°ƒè¯•mainæœåŠ¡å´©æºƒ
```bash
# æ–¹æ³•1: ç›´æ¥è¿›å…¥å®¹å™¨è°ƒè¯•
docker run -it --rm \
  --network gcloud_server_gcloud-network \
  -e DB_HOST=mysql-service \
  -e DB_PASSWORD=gcloud123 \
  -e REDIS_PASSWORD=redis123 \
  luzhipeng728/gcloud-main-service:v3.6.0 \
  /bin/bash

# æ–¹æ³•2: æ£€æŸ¥åº”ç”¨å¯åŠ¨æ—¥å¿—
docker logs gcloud-main 2>&1 | less

# æ–¹æ³•3: ä¿®æ”¹entrypointè¾“å‡ºæ›´è¯¦ç»†çš„é”™è¯¯
```

### 2. éªŒè¯æ•°æ®åº“è¿æ¥
```bash
# åœ¨mainæœåŠ¡å®¹å™¨å†…æµ‹è¯•MySQLè¿æ¥
docker exec gcloud-main sh -c "nc -zv mysql-service 3306"

# æ‰‹åŠ¨æµ‹è¯•Node.jsè¿æ¥
docker exec gcloud-main node -e "
const mysql = require('mysql2/promise');
mysql.createConnection({
  host: 'mysql-service',
  user: 'gcloud',
  password: 'gcloud123',
  database: 'gcloud'
}).then(() => console.log('OK')).catch(console.error);
"
```

### 3. æ£€æŸ¥SequelizeåŒæ­¥
å¯èƒ½æ˜¯Sequelizeåœ¨å°è¯•ALTER TABLEæ—¶å¤±è´¥ã€‚å»ºè®®ï¼š
- åœ¨mainæœåŠ¡çš„å¯åŠ¨è„šæœ¬ä¸­æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ä½¿ç”¨ `sequelize.sync({ alter: false })` è·³è¿‡è‡ªåŠ¨åŒæ­¥
- æˆ–è€…åœ¨é•œåƒæ„å»ºæ—¶å°±å¤„ç†å¥½æ•°æ®åº“schema

### 4. ä½¿ç”¨å·¥ä½œä¸­çš„é…ç½®
å¦‚æœdebugå›°éš¾ï¼Œå¯ä»¥æš‚æ—¶ä½¿ç”¨deploy/docker-compose.ymlï¼ˆéœ€è¦å…ˆcloneä»“åº“ï¼‰ï¼š
```bash
git clone https://github.com/Chatify-AI/gcloud_server.git
cd gcloud_server/deploy
cp .env.example .env
# ä¿®æ”¹.envä¸­çš„å¯†ç 
docker-compose up -d
```

## ğŸ“¦ å¯ç”¨çš„éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆA: å®Œæ•´éƒ¨ç½²åŒ…ï¼ˆéœ€è¦cloneä»“åº“ï¼‰
```bash
git clone https://github.com/Chatify-AI/gcloud_server.git
cd gcloud_server/deploy
docker-compose up -d
```
**ä¼˜ç‚¹**: ç»è¿‡æµ‹è¯•ï¼Œé…ç½®å®Œæ•´
**ç¼ºç‚¹**: éœ€è¦cloneæ•´ä¸ªä»“åº“

### æ–¹æ¡ˆB: å•æ–‡ä»¶éƒ¨ç½²ï¼ˆå®éªŒæ€§ï¼‰
```bash
wget https://raw.githubusercontent.com/Chatify-AI/gcloud_server/v3.6.1/docker-compose.quick.yml
docker-compose -f docker-compose.quick.yml up -d
```
**ä¼˜ç‚¹**: åªéœ€ä¸€ä¸ªæ–‡ä»¶
**ç¼ºç‚¹**: mainæœåŠ¡å½“å‰æœ‰å¯åŠ¨é—®é¢˜

### æ–¹æ¡ˆC: å¸¦Nginxçš„å•æ–‡ä»¶éƒ¨ç½²ï¼ˆå®éªŒæ€§ï¼‰
```bash
wget https://raw.githubusercontent.com/Chatify-AI/gcloud_server/v3.6.1/docker-compose.standalone.yml
docker-compose -f docker-compose.standalone.yml up -d
```
**ä¼˜ç‚¹**: åŒ…å«Nginxåå‘ä»£ç†
**ç¼ºç‚¹**: mainæœåŠ¡å½“å‰æœ‰å¯åŠ¨é—®é¢˜

## ğŸ¯ ç›®æ ‡çŠ¶æ€

æœ€ç»ˆç›®æ ‡æ˜¯ç”¨æˆ·èƒ½å¤Ÿï¼š
```bash
wget https://raw.githubusercontent.com/Chatify-AI/gcloud_server/v3.6.1/docker-compose.quick.yml
docker-compose -f docker-compose.quick.yml up -d
# ç­‰å¾…2-3åˆ†é’Ÿ
curl http://localhost:5080/health
# è¿”å›: {"status":"ok"}
```

**å½“å‰è·ç¦»ç›®æ ‡**: 90%
- âœ… SQLè‡ªåŠ¨ä¸‹è½½å’Œåˆå§‹åŒ–
- âœ… æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼ˆMySQL, Redis, FTP, Executor, Statsï¼‰æ­£å¸¸å¯åŠ¨
- âŒ MainæœåŠ¡å´©æºƒé—®é¢˜å¾…è§£å†³

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Docker Composeé¡¹ç›®åç§°
æ‰€æœ‰composeæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„é¡¹ç›®åç§°`gcloud_server`ï¼Œvolumeå’Œnetworkåç§°ï¼š
- Network: `gcloud_server_gcloud-network`
- Volumes: `gcloud_server_mysql_data`, `gcloud_server_redis_data`, ç­‰

### ç¯å¢ƒå˜é‡
é»˜è®¤å¯†ç ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰ï¼š
- `DB_PASSWORD=gcloud123`
- `MYSQL_ROOT_PASSWORD=root123`
- `REDIS_PASSWORD=redis123`

ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ï¼

### å¥åº·æ£€æŸ¥
- MySQL: `mysqladmin ping`
- Redis: `redis-cli ping`
- Main Service: `curl -f http://localhost:3000/health`

MainæœåŠ¡çš„å¥åº·æ£€æŸ¥å¤±è´¥å¯¼è‡´ä¾èµ–æœåŠ¡ï¼ˆstatsï¼‰æ— æ³•å¯åŠ¨ã€‚

---

**æ›´æ–°æ—¶é—´**: 2025-10-20
**ç‰ˆæœ¬**: v3.6.1
**çŠ¶æ€**: ğŸŸ¡ éƒ¨åˆ†å®Œæˆï¼Œéœ€è¦è°ƒè¯•mainæœåŠ¡å´©æºƒé—®é¢˜
